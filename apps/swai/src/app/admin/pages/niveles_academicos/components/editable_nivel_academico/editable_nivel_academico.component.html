<section
    class="card"
    data-hover="true"
  >
    <header class="flex items-start justify-between flex-wrap gap-5">
      <div>
        <h5>{{ NIVEL_ACADEMICO_CARDINAL_MAP[nivel_academico().numero] }} Año</h5>
        <p class="text-sm">{{ nivel_academico().nombre }}</p>
      </div>

      <div class="flex gap-2">
        
        <button 
        class="rounded-full py-1 hover:bg-primary/10 transition-colors flex items-center gap-3 px-3" (click)="toggle_editing($event)"
        [class]="{
          'text-primary': editing,
          'bg-primary/10': editing,
          'bg-surface-100': !editing,
          'dark:bg-surface-800': !editing
        }"
        >
          {{editing ? 'Modo edición' : 'Editar'}}
          <i class="pi pi-pencil {{editing? 'animate-pulse' : 'text-muted-color'}} text-sm"></i>
        </button>
        @if (!editing) {

          <a class="rounded-full py-1 bg-slate-100 dark:bg-surface-800 hover:bg-primary/10 transition-colors flex items-center gap-3 px-3" [routerLink]="['/admin/niveles_academicos',nivel_academico().numero]">
            Ir a {{nivel_academico().nombre.toLowerCase()}}
            <i class="pi pi-arrow-right text-muted-color text-sm"></i>
          </a>
        }
      </div>
    </header>
    <div class="flex mt-3 gap-3">
      <nav class="flex gap-4 flex-wrap">
        <aw-info-card
          label="Total de estudiantes"
          icon="pi pi-users"
          [value]="
            nivel_academico().cantidad_de_estudiantes.total
          "
        />
        @for (seccion of
        nivel_academico().secciones;
        track $index) {

          @if (editing) {
          <div class="infocard_wrapper">
                      <aw-info-card
                      [className]="obtener_color_seccion_class(seccion.seccion)"
                      [iconContentClassName]="
            obtener_color_seccion_class(seccion.seccion, true)
            "
          [label]="'Seccion ' + seccion.seccion"
          icon="pi pi-book"
          [value]="seccion.cantidad_de_estudiantes.total"
          />

          <div class="infocard_wrapper__overlay | group">
              <button
              class="infocard_wrapper__overlay__button | peer"
              pTooltip="Eliminar"
              tooltipPosition="top"
              showDelay="1000"
              (click)="eliminar_seccion(seccion, $event)"

              >
                <i class="pi pi-trash"></i>
              </button>
              <div class="peer-hover:bg-red-400 peer-hover:dark:bg-red-500 size-full transition-colors"></div>
          </div>
          
        </div>
          } @else {

            
            <aw-info-card
          [className]="obtener_color_seccion_class(seccion.seccion)"
          [iconContentClassName]="
            obtener_color_seccion_class(seccion.seccion, true)
          "
          [label]="'Seccion ' + seccion.seccion"
          icon="pi pi-book"
          [value]="seccion.cantidad_de_estudiantes.total"
          [routerLink]="['/admin/niveles_academicos', seccion.nivel_academico, seccion.seccion]"
          />
        }

        }

        @if (editing) {
          
          @for (seccion of
        secciones_adicionales;
        track $index) {

        <div class="infocard_wrapper">
          <aw-info-card
          class="animate-pulse"
          pTooltip="Seccion no registrada"
          showDelay="500"
            [className]="obtener_color_seccion_class(seccion.seccion)"
            [iconContentClassName]="
              obtener_color_seccion_class(seccion.seccion, true)
            "
            [label]="'Seccion ' + seccion.seccion"
            icon="pi pi-book"
            [value]="seccion.cantidad_de_estudiantes.total"
          />

          <div class="infocard_wrapper__overlay">
              <button
              class="infocard_wrapper__overlay__button | peer"
              pTooltip="Eliminar"
              tooltipPosition="top"
              showDelay="1000"
              (click)="eliminar_seccion(seccion, $event)"
              >
                <i class="pi pi-trash"></i>
              </button>
              <div class="peer-hover:bg-red-400 size-full transition-colors"></div>
          </div>
        </div>

        }
      }
        
        @if (editing) {
        <p-button
          icon="pi pi-plus"
          label="Añadir Seccion"
          severity="secondary"
          styleClass="h-full rounded-xl"
          (click)="add_seccion()"
        ></p-button>
        }
      </nav>
    </div>
    <section class="mt-3">
      <h6>Materias ({{ nivel_academico().pensum.length }})</h6>
      <ul class="mt-3 flex flex-wrap gap-1">
        @for (area_de_formacion of nivel_academico().pensum; track $index) {
        <li>
          <p-tag
            icon="pi pi-book"
            [value]="area_de_formacion.nombre"
            [rounded]="true"
            styleClass="bg-slate-100 text-current dark:bg-surface-800"
          />
        </li>
        }
      </ul>
    </section>
    @if (editing) {
      <p-divider class="my-5"></p-divider>
      <div class="flex justify-between items-center">
        <p class="text-muted-color">Presione "Aplicar" para reflejar los cambios</p>
        <section class="flex justify-end gap-3">
          <p-button
            label="Cancelar"
            severity="secondary"
            [rounded]="true"
            icon="pi pi-times"
            [disabled]="loading"
            (click)="cancelar()"
            ></p-button>
            <p-button
            [rounded]="true"
            [disabled]="secciones_adicionales.length === 0"
            [loading]="loading"
            label="Aplicar"
            icon="pi pi-check"
            (click)="aplicar_cambios()"
          />
        </section>
      </div>
    }
  </section>
  <p-confirmdialog key="confirm_delete"/>
  <p-confirmpopup key="toggle_editing"/>