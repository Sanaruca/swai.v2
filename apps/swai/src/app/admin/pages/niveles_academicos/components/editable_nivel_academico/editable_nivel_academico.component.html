<section
    class="card"
    data-hover="true"
    style="padding-top: 0;"
  >
    <header class="flex items-start justify-between flex-wrap gap-5 sticky -top-10 card-bg pt-6 pb-2">
      <div>
        <h5>{{ NIVEL_ACADEMICO_CARDINAL_MAP[nivel_academico()] }} A침o</h5>
        <p class="text-sm">{{ $any(NIVELES_ACADEMICOS_MAP[nivel_academico()])?.nombre }}</p>
      </div>


      <div class="flex gap-2">
      @if (loading && !editing) {
        <p-skeleton width="6rem" height="1.9rem" borderRadius="16px"/>
        <p-skeleton width="10rem" height="1.9rem"  borderRadius="16px"/>
      } @else {
        
        <button 
      class="rounded-full py-1 hover:bg-primary/10 transition-colors flex items-center gap-3 px-3" (click)="toggle_editing($event)"
      [class]="{
        'text-primary': editing,
        'bg-primary/10': editing,
        'bg-surface-100': !editing,
        'dark:bg-surface-800': !editing
      }"
      >
        {{editing ? 'Modo edici칩n' : 'Editar'}}
        <i class="pi pi-pencil {{editing? 'animate-pulse' : 'text-muted-color'}} text-sm"></i>
      </button>
      @if (!editing) {
        
        <a class="rounded-full py-1 bg-slate-100 dark:bg-surface-800 hover:bg-primary/10 transition-colors flex items-center gap-3 px-3" [routerLink]="['/admin/niveles_academicos',nivel_academico_data?.numero]">
          Ir a {{nivel_academico_data?.nombre?.toLowerCase()}}
          <i class="pi pi-arrow-right text-muted-color text-sm"></i>
        </a>
      }
    }
  </div>
    </header>
    <div class="flex mt-3 gap-3">
      <nav class="flex gap-4 flex-wrap">
        <aw-info-card
          label="Total de estudiantes"
          icon="pi pi-users"
          [value]="
            nivel_academico_data?.cantidad_de_estudiantes?.total
          "
        />

        @if (loading && !editing) {
          @for (_ of [].constructor(8); track $index) {
            <aw-info-card [loading]="true"/>
          }
        }

        @if (editing) {

          @for (seccion of secciones_editables; track $index) {

            @if (!seccion.aux.existe && !seccion.aux.add) {

              <p-button
          icon="pi pi-plus"
          label="A침adir Seccion {{seccion.seccion}}"
          severity="secondary"
          styleClass="h-full rounded-xl animate-pulse"
          pTooltip="Seccion inexistente"
          showDelay="500"
          (click)="seccion.aux.add = true"
          [disabled]="loading"
        ></p-button>
              
            } @else {
              
              <div class="infocard_wrapper">
                <aw-info-card
              [className]="obtener_color_seccion_class(seccion.seccion)"
              [iconContentClassName]="
            obtener_color_seccion_class(seccion.seccion, true)
            "
          [label]="'Seccion ' + seccion.seccion"
          icon="pi pi-book"
          [value]="seccion.cantidad_de_estudiantes.total"
          [class]="{'animate-pulse': seccion.aux.add}"
          />
  
          <div class="infocard_wrapper__overlay | group">
              <button
              class="infocard_wrapper__overlay__button | peer"
              pTooltip="Eliminar"
              tooltipPosition="top"
              showDelay="300"
              (click)="eliminar_seccion(seccion, $event)"
  
              >
                <i class="pi pi-trash"></i>
              </button>
              <div class="peer-hover:bg-red-400 peer-hover:dark:bg-red-500 size-full transition-colors"></div>
            </div>
            
          </div>
        }
        }
          
        } @else if(!loading) {
          
          @for (seccion of
          nivel_academico_data?.secciones;
          track $index) {
  
  
              
              <aw-info-card
            [className]="obtener_color_seccion_class(seccion.seccion)"
            [iconContentClassName]="
              obtener_color_seccion_class(seccion.seccion, true)
            "
            [label]="'Seccion ' + seccion.seccion"
            icon="pi pi-book"
            [value]="seccion.cantidad_de_estudiantes.total"
            [link]="['/admin/niveles_academicos', seccion.nivel_academico, seccion.seccion]"
            />
          
  
          }
        }


        @if (editing) {
          
          @for (seccion of
        secciones_adicionales;
        track $index) {

        <div class="infocard_wrapper">
          <aw-info-card
          class="animate-pulse"
          pTooltip="Seccion no registrada"
          showDelay="500"
            [className]="obtener_color_seccion_class(seccion.seccion)"
            [iconContentClassName]="
              obtener_color_seccion_class(seccion.seccion, true)
            "
            [label]="'Seccion ' + seccion.seccion"
            icon="pi pi-book"
            [value]="seccion.cantidad_de_estudiantes.total"
          />

          <div class="infocard_wrapper__overlay">
              <button
              class="infocard_wrapper__overlay__button | peer"
              pTooltip="Eliminar"
              tooltipPosition="top"
              showDelay="1000"
              (click)="eliminar_seccion(seccion, $event)"
              >
                <i class="pi pi-trash"></i>
              </button>
              <div class="peer-hover:bg-red-400 peer-hover:dark:bg-red-500 size-full transition-colors"></div>
          </div>
        </div>

        }
      }
        
        @if (editing) {
        <p-button
          icon="pi pi-plus"
          label="A침adir Seccion"
          severity="secondary"
          styleClass="h-full rounded-xl"
          (click)="add_seccion()"
          [disabled]="loading"
        ></p-button>
        }
      </nav>
    </div>
    <section class="mt-3">
      <h6>Materias 
        @if (!loading) {
          ({{ nivel_academico_data?.pensum?.length }})
        }
      </h6>
      <ul class="mt-3 flex flex-wrap gap-1">
        @if (loading && !editing) {
          @for (_ of [].constructor(8); track $index) {
            <li>
              <p-skeleton width="7rem" height="1.7rem" borderRadius="16px" />
            </li>
          }
        } @else if(!loading || editing) {

          
          @for (area_de_formacion of nivel_academico_data?.pensum; track $index) {
            <li>
              <p-tag
              icon="pi pi-book"
              [value]="area_de_formacion.nombre"
              [rounded]="true"
              styleClass="bg-slate-100 text-current dark:bg-surface-800"
              />
            </li>
          }
        }
        </ul>
    </section>
    @if (editing) {
      <p-divider class="my-5"></p-divider>
      <div class="flex justify-between items-center">
        <p class="text-muted-color">Presione "Aplicar" para reflejar los cambios</p>
        <section class="flex justify-end gap-3">
          <p-button
            label="Cancelar"
            severity="secondary"
            [rounded]="true"
            icon="pi pi-times"
            [disabled]="loading"
            (click)="cancelar()"
            ></p-button>
            <p-button
            [rounded]="true"
            [disabled]="!puede_aplicar_cambios"
            [loading]="loading"
            label="Aplicar"
            icon="pi pi-check"
            (click)="aplicar_cambios()"
          />
        </section>
      </div>
    }
  </section>
  <p-confirmdialog key="confirm_delete"/>
  <p-confirmpopup key="toggle_editing"/>