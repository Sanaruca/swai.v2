<header>
  <div class="flex gap-2">
    <h3>{{ cantidad_de_estudiantes.numero }} Año</h3>
    <aw-tag-seccion [seccion]="seccion_academica.seccion" />
  </div>
  <p class="text-sm">
    {{ cantidad_de_estudiantes.nombre }} Seccion "{{
      seccion_academica.seccion
    }}"
  </p>
</header>

<nav class="flex mt-5 gap-4">
  <ul>
    @if (seccion_academica.profesor_guia) {
    <li>
      <aw-fast-link
        [routerLink]="[
          '/admin/empleados',
          seccion_academica.profesor_guia!.cedula
        ]"
        [title]="seccion_academica.profesor_guia! | nombre"
        subtitle="Profesor(a) guía"
      >
        <ng-template #icon>
          <p-avatar
            shape="circle"
            size="large"
            styleClass="w-full h-full"
            [label]="seccion_academica.profesor_guia! | nombre : 'iniciales'"
          />
        </ng-template>
      </aw-fast-link>
    </li>
    }
  </ul>
</nav>

<nav class="flex mt-5 gap-4 overflow-auto">
  <aw-info-card
    label="Total de estudiantes"
    icon="pi pi-users"
    [value]="cantidad_de_estudiantes.total"
  ></aw-info-card>

  <aw-info-card
    label="Estudiantes Activos"
    icon="pi pi-check-circle text-green-500"
    [value]="cantidad_de_estudiantes.activos"
    className="bg-green-100 dark:bg-green-600"
    iconContentClassName="bg-green-200"
  ></aw-info-card>

  <aw-info-card
    label="Estudiantes No inscritos"
    icon="pi pi-exclamation-circle text-yellow-600"
    [value]="cantidad_de_estudiantes.no_inscritos"
    className="bg-yellow-100 dark:bg-yellow-600"
    iconContentClassName="bg-yellow-200"
  ></aw-info-card>
</nav>

<section class="mt-4">
  <h5>Materias ({{ pensum.areas_de_formacion.length }})</h5>
  <ul class="mt-3 flex flex-wrap gap-1">
    @for (area_de_formacion of pensum.areas_de_formacion; track $index) {
    <li>
      <p-tag
        icon="pi pi-book"
        [value]="area_de_formacion.nombre"
        [rounded]="true"
        styleClass="bg-slate-100 text-current dark:bg-surface-800"
      />
    </li>
    }
  </ul>
</section>

<section class="layout_card | mt-5">
  <h6>Estudiantes</h6>
  <p-table
    dataKey="cedula"
    selectionMode="single"
    [paginator]="true"
    [rowHover]="true"
    [showLoader]="false"
    [rows]="estudiantes.limit"
    [lazy]="true"
    [value]="estudiantes.data"
    [totalRecords]="estudiantes.total"
    [tableStyle]="{ 'min-width': '50rem' }"
    [loading]="loading"
    [showCurrentPageReport]="true"
    currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} estudiantes"
    paginatorLocale="es-VE"
    paginatorStyleClass="justify-end"
    [rowsPerPageOptions]="[5, 10, 20]"
    (onLazyLoad)="cargar_estudiantes($event)"
  >
    <ng-template #caption>
      <div class="flex">
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>
          <input
            pInputText
            type="text"
            [formControl]="busqueda_input"
            placeholder="Búsqueda"
          />
        </p-iconfield>
      </div>
    </ng-template>
    <ng-template #header>
      <tr>
        <th>Nombre</th>
        <th>Cedula</th>
        <th>Sexo</th>
        <th class="text-center">Edad</th>
        <th></th>
        <th>Estado</th>
        <th class="text-center">Fecha de Nacimiento</th>
        <th>Actualizado</th>
        <th class="text-end">Fecha de inscripcion</th>
        <th class="text-end"></th>
      </tr>
    </ng-template>
    <ng-template #loadingbody>
      @for (n of [].constructor(estudiantes.limit); track $index) {
      <tr>
        <td>
          <div class="flex gap-3">
            <p-skeleton shape="circle" size="3rem" />
            <p-skeleton width="10rem" />
          </div>
        </td>
        <td>
          <p-skeleton width="6rem" />
        </td>
        <td><p-skeleton width="6rem" height="1.5rem" borderRadius="16px" /></td>
        <td class="text-center">
          <p-skeleton width="2rem" styleClass="m-auto" />
        </td>
        <td></td>
        <td>
          <p-skeleton width="6rem" height="1.5rem" borderRadius="16px" />
        </td>
        <td>
          <p-skeleton width="5rem" styleClass="m-auto" />
        </td>
        <td>
          <p-skeleton width="5rem" styleClass="m-auto" />
        </td>
        <td>
          <p-skeleton width="5rem" styleClass="ml-auto" />
        </td>
        <td></td>
      </tr>

      }
    </ng-template>
    <ng-template #body let-estudiante let-i="rowIndex">
      <tr
        *ngIf="!loading"
        [pSelectableRow]="estudiante"
        (dblclick)="
          navigateOnDoubleClick(['admin', 'estudiantes', estudiante.cedula])
        "
      >
        <td>
          <div
            class="flex gap-3"
            [pTooltip]="estudiante.nombres + ' ' + estudiante.apellidos"
            tooltipPosition="top"
          >
            <p-avatar
              [label]="estudiante | nombre : 'iniciales'"
              styleClass="flex-none"
              size="large"
              shape="circle"
            />
            <p class="font-medium">
              {{ estudiante | nombre }}
            </p>
          </div>
        </td>
        <td class="font-medium text-nowrap">
          V-{{ estudiante.cedula | number }}
        </td>
        <td><aw-tag-sexo [sexo]="estudiante.sexo" /></td>
        <td class="text-center font-medium">{{ estudiante.edad }}</td>
        <!-- TODO: colocar icono de discapasidad si posee -->
        <td></td>
        <td>
          <aw-tag-estado-academico [estado]="estudiante.estado_academico.id" />
        </td>
        <td class="text-center">
          {{ estudiante.fecha_de_nacimiento | date : 'dd/MM/yyyy' }}
        </td>
        <td>
          {{ estudiante.ultima_actualizacion | amLocale : 'es' | amTimeAgo }}
        </td>
        <td class="text-end">
          {{ estudiante.fecha_de_inscripcion | date : 'dd/MM/yyyy' }}
        </td>
        <td class="text-end">
          <div class="relative">
            <p-button
              icon="pi pi-ellipsis-h"
              severity="secondary"
              variant="text"
            />
            <!-- <p-menu #menu [model]="getActions(estudiante)" [popup]="true" /> -->
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="9" class="pointer-events-none">
          <div class="grid justify-center justify-items-center py-5 gap-2">
            <aw-illustration name="no-data" class="h-56" />
            <p class="font-medium">Sin Resultados</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</section>
